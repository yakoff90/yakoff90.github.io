!function() {
    "use strict";

    const menuItems = [
        {
            id: 'netflix',
            title: 'Netflix',
            icon: `<svg height="30" viewBox="124.528 16 262.944 480" xmlns="http://www.w3.org/2000/svg">
                    <path d="m216.398 16h-91.87v480c30.128-7.135 61.601-10.708 91.87-12.052z" fill="#E50914"/>
                    <path d="m387.472 496v-480h-91.87v468.904c53.636 3.416 91.87 11.096 91.87 11.096z" fill="#E50914"/>
                    <path d="m387.472 496-171.074-480h-91.87l167.03 468.655c55.75 3.276 95.914 11.345 95.914 11.345z" fill="#E50914"/>
                   </svg>`,
            url: "discover/tv?language=uk&with_networks=213",
            source: "tmdb"
        },
        {
            id: 'disney',
            title: 'Disney+',
            icon: `<svg width="30" height="30" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                     <path d="M19,3V7m2-2H17" fill="none" stroke="rgb(44,169,188)" stroke-width="2"/>
                     <line x1="6.69" y1="9" x2="8.69" y2="21" stroke="currentColor" stroke-width="2"/>
                     <path d="M3,6s12.29-2,13.91,6.77c1.09,5.93-6.58,6.7-9.48,5.89S3,16.06,3,14.06C3,11,8.54,9.45,12,12" stroke="currentColor" stroke-width="2"/>
                   </svg>`,
            url: "discover/tv?language=uk&with_networks=2739",
            source: "tmdb"
        },
        {
            id: 'prime',
            title: 'Prime',
            icon: `<svg width="24px" height="24px" viewBox="0 0 24 24" role="img" xmlns="http://www.w3.org/2000/svg">
  <title>Prime icon</title>
  <path fill="currentColor" d="M22.787 15.292c-.336-.43-2.222-.204-3.069-.103-.257.031-.296-.193-.065-.356 1.504-1.056 3.968-.75 4.255-.397.288.357-.076 2.827-1.485 4.007-.217.18-.423.084-.327-.155.317-.792 1.027-2.566.69-2.996m-1.093 1.248c-2.627 1.94-6.437 2.97-9.717 2.97-4.597 0-8.737-1.7-11.87-4.528-.246-.222-.026-.525.27-.353 3.38 1.967 7.559 3.151 11.876 3.151a23.63 23.63 0 0 0 9.06-1.854c.444-.188.816.293.381.614m.482-5.038c-.761 0-1.346-.209-1.755-.626-.409-.418-.613-1.017-.613-1.797 0-.799.209-1.425.627-1.88.418-.454.998-.682 1.741-.682.572 0 1.019.138 1.341.415.323.276.484.645.484 1.105 0 .461-.174.81-.52 1.046-.348.237-.86.355-1.535.355-.35 0-.654-.034-.912-.101.037.411.161.706.373.884.212.178.533.268.963.268.172 0 .34-.011.502-.033a6.208 6.208 0 0 0 .733-.157.304.304 0 0 1 .046-.004c.104 0 .156.07.156.212v.424c0 .098-.013.167-.04.207a.341.341 0 0 1-.162.106 3.954 3.954 0 0 1-1.429.258m-.304-2.893c.314 0 .541-.048.682-.143.142-.095.212-.241.212-.438 0-.387-.23-.58-.69-.58-.59 0-.931.362-1.024 1.087.246.05.52.074.82.074m-9.84 2.755c-.08 0-.139-.018-.176-.055-.036-.037-.055-.096-.055-.175V6.886c0-.086.019-.146.055-.18.037-.034.096-.05.176-.05h.663c.141 0 .227.067.258.202l.074.249c.325-.215.619-.367.88-.456.26-.09.53-.134.806-.134.553 0 .943.197 1.17.59a3.77 3.77 0 0 1 .885-.452c.276-.092.562-.138.857-.138.43 0 .763.12 1 .36.236.239.354.574.354 1.004v3.253c0 .08-.017.138-.05.175-.034.037-.094.055-.18.055h-.885c-.08 0-.138-.018-.175-.055-.037-.037-.055-.096-.055-.175V8.176c0-.418-.188-.627-.562-.627-.332 0-.667.08-1.005.24v3.345c0 .08-.017.138-.05.175-.034.037-.094.055-.18.055h-.884c-.08 0-.139-.018-.176-.055-.036-.037-.055-.096-.055-.175V8.176c0-.418-.187-.627-.562-.627-.344 0-.682.083-1.013.249v3.336c0 .08-.017.138-.051.175-.034.037-.094.055-.18.055zM9.987 5.927c-.234 0-.42-.064-.562-.193-.142-.129-.212-.304-.212-.525 0-.221.07-.397.212-.526.141-.129.328-.193.562-.193.233 0 .42.064.562.193a.676.676 0 0 1 .212.526c0 .22-.07.396-.212.525-.141.129-.329.193-.562.193m-.443 5.437c-.08 0-.138-.019-.175-.055-.037-.037-.055-.096-.055-.176V6.886c0-.086.018-.146.055-.18.037-.034.096-.05.175-.05h.885c.086 0 .146.016.18.05s.05.094.05.18v4.247c0 .08-.017.139-.05.176-.034.036-.094.055-.18.055zm-3.681 0c-.08 0-.139-.018-.176-.055-.036-.037-.055-.096-.055-.175V6.886c0-.086.019-.146.055-.18.037-.034.096-.05.176-.05h.663c.141 0 .227.067.258.202l.12.497c.245-.27.477-.462.695-.575.219-.114.45-.17.696-.17h.13c.085 0 .147.016.183.05.037.034.056.094.056.18v.773c0 .08-.017.139-.051.176-.034.036-.094.055-.18.055a1.93 1.93 0 0 1-.166-.01 2.968 2.968 0 0 0-.258-.009c-.14 0-.313.02-.516.06-.202.04-.374.091-.515.152v3.097c0 .08-.018.138-.051.175-.034.037-.094.055-.18.055zM.344 13.262c-.08 0-.138-.017-.175-.05-.037-.034-.055-.095-.055-.18V6.886c0-.086.018-.146.055-.18.037-.034.095-.05.175-.05h.664c.14 0 .227.067.258.202l.064.24a2.03 2.03 0 0 1 .668-.424 2.13 2.13 0 0 1 .797-.157c.596 0 1.067.218 1.414.654.348.437.521 1.026.521 1.77 0 .51-.086.955-.258 1.336-.172.38-.405.674-.7.88a1.727 1.727 0 0 1-1.014.308c-.252 0-.491-.04-.719-.12a1.74 1.74 0 0 1-.58-.331v2.018c0 .085-.017.146-.05.18-.034.033-.095.05-.18.05zm2.018-2.81c.344 0 .597-.117.76-.35.163-.234.245-.603.245-1.106 0-.51-.08-.882-.24-1.115-.16-.234-.415-.35-.765-.35-.32 0-.62.083-.903.248v2.424c.27.166.571.249.903.249Z"/></svg>`,
            url: "discover/tv?language=uk&with_networks=1024",
            source: "tmdb"
        },
        {
            id: 'apple',
            title: 'Apple',
            icon: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" height="30">
                     <path d="M18.71 19.5c-.83 1.24-1.71 2.45-3.05 2.47-1.34.03-1.77-.79-3.29-.79-1.53 0-2 .77-3.27.82-1.31.05-2.3-1.32-3.14-2.53C4.25 17 2.94 12.45 4.7 9.39c.87-1.52 2.43-2.48 4.12-2.51 1.28-.02 2.5.87 3.29.87.78 0 2.26-1.07 3.81-.91.65.03 2.47.26 3.64 1.98-.09.06-2.17 1.28-2.15 3.81.03 3.02 2.65 4.03 2.68 4.04-.03.07-.42 1.44-1.38 2.83M13 3.5c.73-.83 1.94-1.46 2.94-1.5.13 1.17-.34 2.35-1.04 3.19-.69.85-1.83 1.51-2.95 1.42-.15-1.15.41-2.35 1.05-3.11z"/>
                   </svg>`,
            url: "discover/tv?language=uk&with_networks=2552",
            source: "tmdb"
        },
        {
            id: 'hbo',
            title: 'HBO Max',
            icon: `<svg width="24px" height="24px" viewBox="0 0 24 24" fill="currentColor" role="img" xmlns="http://www.w3.org/2000/svg">
                     <path d="M7.042 16.896H4.414v-3.754H2.708v3.754H.01L0 7.22h2.708v3.6h1.706v-3.6h2.628zm12.043.046C21.795 16.94 24 14.689 24 11.978a4.89 4.89 0 0 0-4.915-4.92c-2.707-.002-4.09 1.991-4.432 2.795.003-1.207-1.187-2.632-2.58-2.634H7.59v9.674l4.181.001c1.686 0 2.886-1.46 2.888-2.713.385.788 1.72 2.762 4.427 2.76zm-7.665-3.936c.387 0 .692.382.692.817 0 .435-.305.817-.692.817h-1.33v-1.634zm.005-3.633c.387 0 .692.382.692.817 0 .436-.305.818-.692.818h-1.33V9.373zm1.77 2.607c.305-.039.813-.387.992-.61-.063.276-.068 1.074.006 1.35-.204-.314-.688-.701-.998-.74zm3.43 0a2.462 2.462 0 1 1 4.924 0 2.462 2.462 0 0 1-4.925 0zm2.462 1.936a1.936 1.936 0 1 0 0-3.872 1.936 1.936 0 0 0 0 3.872z"/>
                   </svg>`,
            url: "discover/tv?language=uk&with_networks=49",
            source: "tmdb"
        },
        {
            id: 'hulu',
            title: 'Hulu',
            icon: `<svg width="24px" height="24px" viewBox="0 0 24 24" fill="currentColor" role="img" xmlns="http://www.w3.org/2000/svg">
                     <path d="M14.707 15.957h1.912V8.043h-1.912zm-3.357-2.256a.517.517 0 0 1-.512.511H9.727a.517.517 0 0 1-.512-.511v-3.19H7.303v3.345c0 1.368.879 2.09 2.168 2.09h1.868c1.189 0 1.912-.856 1.912-2.09V10.51h-1.912c.01 0 .01 3.09.01 3.19zm10.75-3.19v3.19a.517.517 0 0 1-.512.511h-1.112a.517.517 0 0 1-.511-.511v-3.19h-1.912v3.345c0 1.368.878 2.09 2.167 2.09h1.868c1.19 0 1.912-.856 1.912-2.09V10.51zm-18.32 0H2.557c-.434 0-.645.11-.645.11V8.044H0v7.903h1.9v-3.179c0-.278.234-.511.512-.511h1.112c.278 0 .511.233.511.511v3.19h1.912v-3.446c0-1.445-.967-2-2.167-2z"/>
                   </svg>`,
            url: "discover/tv?language=uk&with_networks=453",
            source: "tmdb"
        }
    ];

    const menuElements = {};

    function initPlugin() {
        if (window.plugin_podbor_ready) return;

        // Додаємо компонент в налаштування
        Lampa.SettingsApi.addComponent({
            component: "porborki",
            icon: `<svg height="36" viewBox="0 0 38 36" fill="none" xmlns="http://www.w3.org/2000/svg" style="transition: all 0.3s ease;">
    <rect x="2" y="8" width="34" height="21" rx="3" stroke="#FF6600" stroke-width="3"/>
    <line x1="13.0925" y1="2.34874" x2="16.3487" y2="6.90754" stroke="#FF6600" stroke-width="3" stroke-linecap="round"/>
    <line x1="1.5" y1="-1.5" x2="9.31665" y2="-1.5" transform="matrix(-0.757816 0.652468 0.652468 0.757816 26.197 2)" stroke="#FF6600" stroke-width="3" stroke-linecap="round"/>
    <line x1="9.5" y1="34.5" x2="29.5" y2="34.5" stroke="#FF6600" stroke-width="3" stroke-linecap="round"/>
    <style>
        svg:hover rect,
        svg:hover line {
            stroke: white !important;
        }
    </style>
</svg>`,
            name: "Підбірки"
        });

        // Додаємо параметри для кожного пункту меню
        menuItems.forEach(item => {
            Lampa.SettingsApi.addParam({
                component: "porborki",
                param: {
                    name: `porborki_${item.id}`,
                    type: "select",
                    values: { 1: "Показати", 0: "Приховати" },
                    default: 0
                },
                field: { name: item.title }
            });
        });

        // Слідкуємо за змінами налаштувань "porborki"
        Lampa.Listener.follow('settings', e => {
            if (e.type === 'change' && e.component === 'porborki') {
                updateMenuItems();
            }
        });

        // Створюємо пункти меню в DOM
        createMenuItems();

        window.plugin_podbor_ready = true;
    }

    function createMenuItems() {
        // Меню в DOM (перший .menu__list)
        const menuList = $(".menu .menu__list").eq(0);

        menuItems.forEach(item => {
            const menuItem = $(`
                <li class="menu__item selector" data-action="${item.id}" style="display: none;">
                    <div class="menu__ico">${item.icon}</div>
                    <div class="menu__text">${item.title}</div>
                </li>
            `);

            menuItem.on("hover:enter", () => {
                Lampa.Activity.push({
                    url: item.url,
                    title: item.title,
                    component: "category_full",
                    source: item.source,
                    sort: "now",
                    card_type: "true",
                    page: 1
                });
            });

            menuList.append(menuItem);
            menuElements[item.id] = menuItem;
        });

        updateMenuItems();
    }

    function updateMenuItems() {
        menuItems.forEach(item => {
            const isVisible = parseInt(Lampa.Storage.get(`porborki_${item.id}`, 'porborki')) === 1;
            const menuItem = menuElements[item.id];

            if (menuItem) {
                if (isVisible) {
                    menuItem.show();
                } else {
                    menuItem.hide();
                }
            }
        });
    }

    // Ініціалізація плагіна при готовності додатку
    if (window.appready) {
        initPlugin();
    } else {
        Lampa.Listener.follow("app", e => {
            if (e.type === "ready") initPlugin();
        });
    }
}();
